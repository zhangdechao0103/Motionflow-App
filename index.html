<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="referrer" content="no-referrer">
    <title>Motiflow VFX - æ¸¸æˆæŠ€æœ¯ç¾æœ¯å¼•æ“</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* æ¸¸æˆå¼•æ“é£æ ¼ UI */
        body { font-family: 'Segoe UI', 'Inter', sans-serif; background-color: #121212; color: #e0e0e0; }
        .glass { background: rgba(30, 30, 30, 0.8); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.08); box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5); }
        
        /* èµ›åš/è™šå¹»å¼•æ“å¼ºè°ƒè‰² */
        .accent-text { color: #4db8ff; text-shadow: 0 0 10px rgba(77, 184, 255, 0.4); }
        .accent-border { border-color: #4db8ff; }
        .accent-bg { background-color: #4db8ff; }

        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 100; opacity: 0; transition: opacity 0.2s; }
        .modal.active { display: flex; opacity: 1; }
        
        /* ç»“æœå¡ç‰‡åŠ¨ç”» */
        .vfx-card { transition: all 0.3s ease; border: 1px solid transparent; }
        .vfx-card:hover { transform: translateY(-5px); border-color: #4db8ff; box-shadow: 0 0 20px rgba(77, 184, 255, 0.15); }
        .grid-item { animation: fadeUp 0.6s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; opacity: 0; transform: translateY(20px); }
        @keyframes fadeUp { to { opacity: 1; transform: translateY(0); } }

        /* æ ‡ç­¾æ ·å¼ */
        .tag { font-family: 'JetBrains Mono', monospace; letter-spacing: -0.5px; }
    </style>
</head>
<body class="min-h-screen pb-20 bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-slate-900 via-[#0a0a0a] to-black">

    <nav class="glass sticky top-0 z-50 px-6 py-4 flex justify-between items-center border-b border-white/5">
        <div class="flex items-center gap-3">
            <div class="w-8 h-8 bg-blue-600 rounded flex items-center justify-center font-bold text-white shadow-lg shadow-blue-500/30">FX</div>
            <span class="text-lg font-bold tracking-tight text-white">MOTIFLOW <span class="text-zinc-500 font-normal">| TECH ART</span></span>
        </div>
        <div class="text-[10px] text-zinc-500 font-mono flex items-center gap-2">
            <span class="w-1.5 h-1.5 rounded-full bg-blue-500 animate-pulse"></span> SYSTEM ONLINE
        </div>
    </nav>

    <header class="max-w-5xl mx-auto pt-16 pb-12 px-6">
        <div id="drop-zone" class="relative p-12 border border-dashed border-zinc-700 rounded-2xl bg-zinc-900/30 text-center hover:border-blue-500/50 hover:bg-zinc-900/50 transition-all duration-300 cursor-pointer group">
            <input type="file" id="file-input" class="hidden" accept="image/*">
            <div id="status-ui">
                <div class="text-5xl mb-6 opacity-80 group-hover:scale-110 transition duration-300">ğŸ®</div>
                <h2 class="text-xl font-bold mb-2 text-white">ä¸Šä¼ æ¸¸æˆ/ç‰¹æ•ˆå‚è€ƒå›¾</h2>
                <p class="text-zinc-500 text-sm font-mono">AI å°†è§£æ Shader/ç²’å­/é£æ ¼ï¼Œå¹¶æ£€ç´¢å¼•æ“å®å½•åŠ¨æ•ˆ</p>
            </div>
            
            <div id="analysis-panel" class="hidden mt-8 pt-6 border-t border-white/5">
                <p class="text-[10px] text-zinc-500 uppercase tracking-widest mb-3">AI Technical Analysis</p>
                <div id="ai-tags" class="flex flex-wrap justify-center gap-2"></div>
            </div>
        </div>
    </header>

    <main class="max-w-[1600px] mx-auto px-6">
        <div id="results-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4">
            </div>
    </main>

    <div id="preview-modal" class="modal" onclick="closeModal()">
        <div class="w-full h-full flex flex-col items-center justify-center p-4" onclick="event.stopPropagation()">
            
            <div class="relative max-w-5xl max-h-[70vh] w-full bg-[#1a1a1a] rounded-lg overflow-hidden border border-zinc-700 shadow-2xl flex items-center justify-center">
                <img id="modal-img" class="max-w-full max-h-full object-contain">
                <div class="absolute bottom-4 left-4 bg-black/60 backdrop-blur px-3 py-1 rounded text-xs text-white font-mono">PREVIEW MODE</div>
            </div>
            
            <div class="mt-6 w-full max-w-4xl grid grid-cols-1 md:grid-cols-2 gap-6 items-center">
                <div>
                    <h3 id="modal-title" class="text-lg font-bold text-white mb-1">VFX Source</h3>
                    <p class="text-xs text-zinc-500">ç‚¹å‡»å³ä¾§æŒ‰é’®å‰å¾€ä¸“ä¸šç´ æç«™æ·±æŒ–</p>
                </div>
                
                <div class="flex flex-wrap gap-3 justify-end">
                    <a id="huaban-btn" href="#" target="_blank" class="flex items-center gap-2 px-5 py-2.5 bg-[#c8222c] hover:bg-[#e62e3a] text-white rounded font-bold text-xs transition">
                        <span>ğŸŒ¸ å»èŠ±ç“£æœ</span>
                    </a>
                    <a id="pinterest-btn" href="#" target="_blank" class="flex items-center gap-2 px-5 py-2.5 bg-[#bd081c] hover:bg-[#e60a23] text-white rounded font-bold text-xs transition">
                        <span>ğŸ“Œ Pinterest</span>
                    </a>
                    <button onclick="saveToEagle()" class="flex items-center gap-2 px-5 py-2.5 bg-blue-600 hover:bg-blue-500 text-white rounded font-bold text-xs transition">
                        <span>â¬‡ å­˜å…¥ Eagle</span>
                    </button>
                    <a id="source-link" href="#" target="_blank" class="flex items-center gap-2 px-4 py-2.5 bg-zinc-800 hover:bg-zinc-700 text-zinc-300 rounded font-bold text-xs transition border border-zinc-700">
                        ğŸ”— åŸç½‘é¡µ
                    </a>
                </div>
            </div>
        </div>
    </div>

    <script>
        const GEMINI_KEY = "AIzaSyB9ww1axSGsO4iYUt9UaOOJiBAuoa0wYOQ";
        // ä½¿ç”¨ Giphy APIï¼Œå› ä¸ºå®ƒçš„æ¸¸æˆå¼€å‘/å¼•æ“ç›¸å…³å†…å®¹æ¯” Tenor æ›´ä¸°å¯Œ
        const GIPHY_KEY = "dc6zaTOxFJmzC"; 

        let currentImgUrl = "";
        let currentKeywords = "";

        const dropZone = document.getElementById('drop-zone');
        const fileInput = document.getElementById('file-input');
        const resultsGrid = document.getElementById('results-grid');
        const aiTagsDiv = document.getElementById('ai-tags');
        const statusUi = document.getElementById('status-ui');
        const analysisPanel = document.getElementById('analysis-panel');

        dropZone.onclick = () => fileInput.click();
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(e => {
            dropZone.addEventListener(e, ev => { ev.preventDefault(); ev.stopPropagation(); });
        });
        dropZone.addEventListener('drop', e => handleFile(e.dataTransfer.files[0]));
        fileInput.addEventListener('change', e => handleFile(e.target.files[0]));

        async function handleFile(file) {
            if (!file) return;
            statusUi.innerHTML = `<div class="animate-spin text-4xl mb-4 text-blue-500">âš™ï¸</div><p class="text-blue-400 font-bold uppercase tracking-widest text-xs">Analyzing Shader & VFX Style...</p>`;
            resultsGrid.innerHTML = "";
            aiTagsDiv.innerHTML = "";
            analysisPanel.classList.add('hidden');

            try {
                const base64 = await toBase64(file);
                
                // --- 1. AI æ·±åº¦æŠ€æœ¯åˆ†æ ---
                // è¿™é‡Œçš„ Prompt ä¸“é—¨ä¸ºæ¸¸æˆ VFX ä¼˜åŒ–ï¼Œè¦æ±‚è¾“å‡ºæŠ€æœ¯æœ¯è¯­
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${GEMINI_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [
                            { text: "Act as a Lead Technical Artist. Analyze this image. I need search keywords to find similar GAMEPLAY VFX or UI MOTION. \nOutput 3 lines:\nLine 1: 3 specific English tech keywords for searching GIF engines (e.g. 'unity shader graph', 'ue5 particle', 'pixel art explosion').\nLine 2: 1 Chinese keyword for Huaban search (e.g. æ¸¸æˆç‰¹æ•ˆ, åˆ€å…‰ç‰¹æ•ˆ).\nLine 3: 1 short style description." },
                            { inline_data: { mime_type: "image/jpeg", data: base64.split(',')[1] } }
                        ]}]
                    })
                });

                const data = await response.json();
                const lines = data.candidates[0].content.parts[0].text.trim().split('\n');
                
                // è§£æ AI è¿”å›çš„æ•°æ®
                const engKeywords = lines[0].replace(/Line 1:/i, '').trim(); // è‹±æ–‡æŠ€æœ¯è¯
                const cnKeyword = lines[1] ? lines[1].replace(/Line 2:/i, '').trim() : "æ¸¸æˆç‰¹æ•ˆ"; // ä¸­æ–‡æœç´¢è¯
                
                // UI å±•ç¤º
                statusUi.innerHTML = `<div class="text-4xl mb-4">âœ…</div><p class="text-zinc-400 font-bold text-xs">ANALYSIS COMPLETE</p>`;
                analysisPanel.classList.remove('hidden');
                
                const tags = engKeywords.split(/[,]+/).map(t => t.trim());
                aiTagsDiv.innerHTML = tags.map(t => `<span class="tag px-3 py-1 bg-blue-900/30 text-blue-400 text-[10px] border border-blue-500/30 rounded uppercase">${t}</span>`).join('') + `<span class="tag px-3 py-1 bg-red-900/30 text-red-400 text-[10px] border border-red-500/30 rounded">${cnKeyword}</span>`;

                // --- 2. æ··åˆæœç´¢ç­–ç•¥ ---
                // æˆ‘ä»¬åœ¨æœç´¢è¯åå¼ºåˆ¶åŠ ä¸Š "gameplay" "vfx" "unity" ç­‰åç¼€ï¼Œè¿‡æ»¤æ‰åŠ¨æ¼«/çœŸäºº
                searchGiphy(engKeywords, cnKeyword);

            } catch (err) {
                console.error(err);
                searchGiphy("game vfx, unity shader", "æ¸¸æˆç‰¹æ•ˆ");
            }
        }

        async function searchGiphy(query, cnKeyword) {
            // æ„é€ å¼ºåŒ–çš„æœç´¢è¯ï¼šå…³é”®è¯ + å¼•æ“/å¼€å‘æœ¯è¯­
            // ä¾‹å¦‚ï¼š "Fire Ball" -> "Fire Ball Unity VFX Gameplay"
            const techQuery = `${query} vfx gameplay`; 
            
            try {
                const res = await fetch(`https://api.giphy.com/v1/gifs/search?api_key=${GIPHY_KEY}&q=${encodeURIComponent(techQuery)}&limit=20&rating=g`);
                const data = await res.json();

                if (data.data.length === 0) {
                    resultsGrid.innerHTML = `<div class="col-span-full text-center py-20 text-zinc-600">No direct GIFs found. Try the external buttons below.</div>`;
                } else {
                    resultsGrid.innerHTML = data.data.map((gif, index) => {
                        // ä¼˜å…ˆä½¿ç”¨åŸå§‹ MP4 ä»¥è·å¾—æ›´å¥½ç”»è´¨ï¼Œæˆ–è€…é«˜è´¨é‡ GIF
                        const previewUrl = gif.images.fixed_height.url; 
                        const hdUrl = gif.images.original.url;
                        const sourceUrl = gif.url;
                        
                        return `
                            <div class="vfx-card bg-zinc-900 rounded-lg overflow-hidden relative group cursor-pointer grid-item"
                                 style="animation-delay: ${index * 0.05}s"
                                 onclick="openModal('${hdUrl}', '${query}', '${cnKeyword}', '${sourceUrl}')">
                                <div class="aspect-[4/3] bg-black relative">
                                    <img src="${previewUrl}" class="w-full h-full object-cover opacity-80 group-hover:opacity-100 transition duration-300">
                                    <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition duration-300 flex flex-col justify-end p-3">
                                        <span class="text-[10px] text-blue-400 font-mono font-bold uppercase tracking-wider mb-1">VFX PREVIEW</span>
                                        <span class="text-[10px] text-zinc-400 truncate">${gif.title}</span>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('');
                }
                
                // ä¿å­˜å½“å‰çš„æœç´¢è¯ï¼Œä¾›å¼¹çª—ä½¿ç”¨
                currentKeywords = { eng: query, cn: cnKeyword };

            } catch (e) {
                resultsGrid.innerHTML = `<div class="col-span-full text-center text-red-500">Network Error</div>`;
            }
        }

        // --- æ ¸å¿ƒï¼šæ·±åº¦é¢„è§ˆ & å¤–éƒ¨è·³è½¬é€»è¾‘ ---
        function openModal(imgUrl, engQuery, cnQuery, sourceUrl) {
            currentImgUrl = imgUrl;
            
            const modal = document.getElementById('preview-modal');
            const img = document.getElementById('modal-img');
            const title = document.getElementById('modal-title');
            
            const huabanBtn = document.getElementById('huaban-btn');
            const pinterestBtn = document.getElementById('pinterest-btn');
            const sourceLink = document.getElementById('source-link');

            // 1. è®¾ç½®é¢„è§ˆå›¾
            img.src = imgUrl;
            title.innerText = `Search: ${engQuery}`;
            
            // 2. æ„é€ èŠ±ç“£ç½‘æœç´¢é“¾æ¥ (ä½¿ç”¨ AI æå–çš„ä¸­æ–‡ä¸“ä¸šè¯)
            // èŠ±ç“£æœä¸­æ–‡æ›´å‡†ï¼š "æ¸¸æˆç‰¹æ•ˆ" "äºŒæ¬¡å…ƒ çˆ†ç‚¸"
            huabanBtn.href = `https://huaban.com/search/?q=${encodeURIComponent(cnQuery + " æ¸¸æˆç‰¹æ•ˆ")}`;
            
            // 3. æ„é€  Pinterest æœç´¢é“¾æ¥ (ä½¿ç”¨ AI æå–çš„è‹±æ–‡ä¸“ä¸šè¯)
            // Pinterest æœè‹±æ–‡æ›´å‡†ï¼š "Game VFX Unity"
            pinterestBtn.href = `https://www.pinterest.com/search/pins/?q=${encodeURIComponent(engQuery + " Game VFX UI")}`;
            
            // 4. åŸç½‘é¡µé“¾æ¥
            sourceLink.href = sourceUrl;

            modal.classList.add('active');
        }

        function closeModal() {
            document.getElementById('preview-modal').classList.remove('active');
            setTimeout(() => document.getElementById('modal-img').src = "", 200);
        }

        async function saveToEagle() {
            try {
                const res = await fetch("http://localhost:44324/api/item/addFromURL", {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        url: currentImgUrl, 
                        name: "VFX_Ref_" + Date.now(), 
                        tags: ["Motiflow", "Game VFX", "Reference"] 
                    })
                });
                if (res.ok) alert("âœ… Saved to Eagle!");
                else throw new Error();
            } catch (e) { alert("âš ï¸ Eagle Connection Failed. Make sure Eagle is running."); }
        }

        function toBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        }
    </script>
</body>
</html>
