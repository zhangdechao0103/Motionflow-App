<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>Motiflow AI - çµæ„Ÿäº¤äº’ç»ˆç«¯</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: sans-serif; background-color: #050505; color: #f4f4f5; }
        .glass { background: rgba(20, 20, 20, 0.8); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .accent-gradient { background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%); }
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 100; align-items: center; justify-content: center; padding: 20px; }
        .modal.active { display: flex; }
        .result-card video { cursor: zoom-in; }
    </style>
</head>
<body class="min-h-screen pb-24">

    <nav class="glass sticky top-0 z-50 px-8 py-4 flex justify-between items-center">
        <div class="flex items-center gap-3">
            <div class="w-8 h-8 accent-gradient rounded-lg flex items-center justify-center font-bold italic">M</div>
            <span class="text-xl font-bold tracking-tighter uppercase italic">Motiflow AI</span>
        </div>
        <div id="connection-status" class="text-[10px] text-zinc-500 font-mono">REMOTE ENGINE: CONNECTED</div>
    </nav>

    <header class="max-w-4xl mx-auto pt-16 pb-12 px-6">
        <div id="drop-zone" class="relative p-12 border-2 border-dashed border-zinc-800 rounded-[2.5rem] bg-zinc-900/20 text-center hover:border-purple-500 transition-all cursor-pointer group">
            <input type="file" id="file-input" class="hidden" accept="image/*">
            <div id="status-ui">
                <div class="text-5xl mb-6">ğŸª„</div>
                <h2 class="text-xl font-bold mb-2">æŠ•å…¥å‚è€ƒå›¾ï¼Œå¯»æ‰¾åŠ¨æ€çµæ„Ÿ</h2>
                <p class="text-zinc-500 text-sm">ç‚¹å‡»å¡ç‰‡å¯æŸ¥çœ‹å¤§å›¾ï¼Œå¹¶ä¸€é”®å¯¼å…¥ Eagle</p>
            </div>
            <div id="ai-tags" class="mt-8 flex flex-wrap justify-center gap-2"></div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-6">
        <div id="results-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            </div>
    </main>

    <div id="preview-modal" class="modal" onclick="closeModal()">
        <div class="max-w-5xl w-full" onclick="event.stopPropagation()">
            <video id="modal-video" controls loop autoplay class="w-full rounded-3xl shadow-2xl"></video>
            <div class="mt-6 flex justify-between items-center px-4">
                <h3 id="modal-title" class="text-xl font-bold text-white">åŠ¨æ•ˆè¯¦æƒ…</h3>
                <div class="flex gap-4">
                    <button onclick="saveToEagle()" class="px-6 py-2 bg-purple-600 hover:bg-purple-500 rounded-full text-sm font-bold transition">å¯¼å…¥ Eagle</button>
                    <button onclick="closeModal()" class="px-6 py-2 bg-zinc-800 rounded-full text-sm font-bold">å…³é—­é¢„è§ˆ</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const GEMINI_KEY = "AIzaSyB9ww1axSGsO4iYUt9UaOOJiBAuoa0wYOQ";
        const EAGLE_API = "http://localhost:44324/api/item/addFromURL"; // Eagle æœ¬åœ°æ¥å£
        
        let currentVideoURL = "";
        let currentTitle = "";

        // åŠ¨æ•ˆåº“
        const DB = [
            { title: "3D Fluid Dynamics", tags: ["3d", "liquid", "abstract"], url: "https://www.w3schools.com/html/mov_bbb.mp4" },
            { title: "Minimal UI Motion", tags: ["minimal", "ui", "clean"], url: "https://v.ftcdn.net/05/14/43/45/700_F_514434538_lE5C6d8jR5P9T4n2X8M9L0Z_ST.mp4" },
            { title: "Gradient Flow", tags: ["gradient", "colors", "liquid"], url: "https://v.ftcdn.net/04/77/89/37/700_F_477893739_mC7PzR7jW1uE8zG8A6f7S3n2X8M9L0Z_ST.mp4" }
        ];

        const fileInput = document.getElementById('file-input');
        const dropZone = document.getElementById('drop-zone');
        const resultsGrid = document.getElementById('results-grid');
        const aiTagsDiv = document.getElementById('ai-tags');
        const statusUi = document.getElementById('status-ui');

        dropZone.onclick = () => fileInput.click();

        fileInput.addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;
            statusUi.innerHTML = `<div class="animate-spin text-4xl mb-4">ğŸŒ€</div><p class="text-purple-400">AI åˆ†æä¸­...</p>`;
            
            try {
                const base64 = await toBase64(file);
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${GEMINI_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [
                            { text: "Output 3 style keywords for this image. English only, comma separated." },
                            { inline_data: { mime_type: "image/jpeg", data: base64.split(',')[1] } }
                        ]}]
                    })
                });
                const data = await response.json();
                const tags = data.candidates[0].content.parts[0].text.trim().toLowerCase();
                renderResults(tags);
            } catch (err) { renderResults("3d, liquid"); }
        });

        function renderResults(tagsStr) {
            const tags = tagsStr.split(',').map(t => t.trim());
            statusUi.innerHTML = `<div class="text-3xl mb-2">âœ¨</div><p class="text-zinc-300">å·²ä¸ºä½ åŒ¹é…ç›¸ä¼¼åŠ¨æ€å‚è€ƒ</p>`;
            aiTagsDiv.innerHTML = tags.map(t => `<span class="px-3 py-1 bg-purple-500/10 text-purple-400 text-[10px] rounded-full uppercase font-bold border border-purple-500/20">${t}</span>`).join('');

            resultsGrid.innerHTML = DB.map((item, index) => `
                <div class="glass rounded-[2rem] overflow-hidden group">
                    <div class="aspect-video bg-zinc-900">
                        <video loop muted playsinline autoplay 
                               onclick="openPreview('${item.url}', '${item.title}')"
                               class="w-full h-full object-cover hover:scale-105 transition duration-500">
                            <source src="${item.url}" type="video/mp4">
                        </video>
                    </div>
                    <div class="p-6 flex justify-between items-center">
                        <h4 class="text-sm font-bold text-zinc-300">${item.title}</h4>
                        <button onclick="saveToEagle('${item.url}', '${item.title}')" class="text-[10px] text-zinc-500 hover:text-white underline">ä¿å­˜è‡³ Eagle</button>
                    </div>
                </div>
            `).join('');
        }

        // é¢„è§ˆæ§åˆ¶
        function openPreview(url, title) {
            currentVideoURL = url;
            currentTitle = title;
            document.getElementById('modal-video').src = url;
            document.getElementById('modal-title').innerText = title;
            document.getElementById('preview-modal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('preview-modal').classList.remove('active');
            document.getElementById('modal-video').pause();
        }

        // ä¿å­˜åˆ° Eagle
        async function saveToEagle(url = currentVideoURL, title = currentTitle) {
            try {
                const response = await fetch(EAGLE_API, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        url: url,
                        name: title,
                        tags: ["Motiflow-AI", "Motion-Ref"]
                    })
                });
                if (response.ok) alert('âœ¨ å·²æˆåŠŸå‘é€è‡³ä½ çš„ Eagleï¼');
                else alert('âŒ ä¿å­˜å¤±è´¥ï¼Œè¯·ç¡®ä¿ Eagle å·²å¼€å¯å¹¶å…è®¸å¤–éƒ¨è¿æ¥ã€‚');
            } catch (e) {
                alert('âš ï¸ æ— æ³•è¿æ¥ Eagleã€‚è¯·æ£€æŸ¥ï¼š\n1. Eagle æ­£åœ¨è¿è¡Œ\n2. åå¥½è®¾ç½®ä¸­å·²å¼€å¯æµè§ˆå™¨æ‰©å±•/API è¿æ¥');
            }
        }

        function toBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        }
    </script>
</body>
</html>
